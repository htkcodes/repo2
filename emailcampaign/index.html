<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://rawgit.com/htkcodes/repo2/master/emailcampaign/query-builder.default.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="dialog-confirm">
        <p>Once saved you cannot stop the process or start over. Are you sure?</p>
    </div>



    <div class="form-body">

        <div class="logo">
            <a href="#">
                <div class="inner"><img src="https://i.imgur.com/VIDLtws.png" alt="NCB Logo" class="logo-size"></div>
            </a>
        </div>
        <div class="row">
            <div class="dropdown">
                <p class="dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                    Quick Navigation
                    <span class="caret"></span>
                </p>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                    <li><a href="#" class="ecg">Email Campaign Generation</a></li>
                    <li><a href="#" class="ecm">Email Campaign Modification</a></li>
                </ul>
            </div>
            <div class="img-holder">
                <div class="bg"></div>
                <div class="info-holder">
                    <img src="email.png" alt="">
                    <h3 class="text-center sidebar-header">Email Campaign</h3>
                </div>
            </div>
            <div class="form">
                <h3>Email Campaign Generation</h3>
                <p class="text-left sub-heading">Define the email campaign criteria below</p>
                <div class="seperator"></div>
                <div class="form-content">
                    <div class="form-items">
                        <div class="col-md-12 col-lg-12">
                            <div class="form-group criteria_master">
                                <label for="criteria_name">Criteria Name</label>
                                <input type="text" class="form-control" id="criteria_name" placeholder="Criteria Name">

                                <span class="help-block"></span>
                            </div>

                            <div id="builder-basic" class="query-builder form-inline">

                            </div>

                            <div class="btn-group">
                                <button class="btn btn-warning reset" data-target="basic" id="btn-reset">Reset</button>
                                <button class="btn btn-primary parse-json" data-target="basic" id="get-save">Save</button>
                            </div>
                            <button class="openload">Open</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.js"></script>
    <script src="jquery-loader.js"></script>
    <script>
        $(".openload").on('click', function () {
            $.loader.open({
                title: 'Loading'
            });
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://rawgit.com/mistic100/jQuery.extendext/master/jQuery.extendext.min.js"></script>
    <script src="https://rawgit.com/htkcodes/repo2/master/emailcampaign/query-builder.standalone.js"></script>
    <script>
        $('#criteria_name').focus();

        $('#criteria_name').focusout(function () {
            if (!$('#criteria_name').val()) {
                $('.criteria_master').addClass('has-error');
                $('.help-block').html('Please enter a criteria name')
                $('#criteria_name').focus();
                $('#get-save').attr('disabled', true);
            }
        })
        $('#criteria_name').on('keyup', function () {
            $('.criteria_master').removeClass('has-error');
            $('.help-block').html('');
            $('#get-save').removeAttr('disabled');
        })



        $("#dialog-confirm").dialog({
            autoOpen: false,
            resizable: false,
            title: 'Are you sure?',
            height: "auto",
            width: 400,
            modal: true,
            buttons: {
                "Yes": function () {
                    $(this).dialog('close');
                    var sql_raw = $('#builder-basic').queryBuilder('getSQL', false, true);
                    console.log(sql_raw);
                    var newSql = sql_raw.sql.replace(/%/g, '#');
                    console.log(newSql)
                },
                Cancel: function () {
                    $(this).dialog("close");
                }
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <script>
        $('#builder-basic').queryBuilder({
            plugins: ['bt-tooltip-errors'],

            filters: [{
                    id: 'ACCOUNT_NUMBER',
                    label: 'Account Number',
                    type: 'integer',
                    input: 'number',
                    validation: {
                        messages: {
                            format: 'Please ensure the input value is a number'
                        }
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ],
                },
                {
                    id: 'CI_ARREARS',
                    label: 'Arrears(Loans)',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_MINIMUMAMTDUE',
                    label: 'Mininum Payment(Cards)',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_CURRENTBAL',
                    label: 'Current Balance',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'UPPER(ci_occupation)',
                    label: 'Occupation',
                    type: 'integer',
                    input: 'select',
                    values: {
                        'DOCTOR': 'DOCTOR',
                        'TEACHER': 'TEACHER',
                        'FIRE': 'FIRE',
                        'SOLDIER': 'SOLDIER',
                        'LAWYER': 'LAWYER',
                        'HOUSEKEEPER': 'HOUSEKEEPER',
                        'CHEF': 'CHEF',
                        'WAITRESS': 'WAITRESS',
                        'OTHERS': ''
                    },
                    operators: ['contains', 'not_contains']
                }, {
                    id: 'UPPER(CI_CURRENCY)',
                    label: 'Currency',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'GBP',
                        'USD',
                        'CAD',
                        'JMD'
                    ],
                    operators: ['equal', 'not_equal']
                }, {
                    id: 'CI_PAYMENTDUEDATE',
                    label: 'Payment Due Date',
                    type: 'date',
                    validation: {
                        format: 'DD/MMM/YYYY'
                    },
                    plugin: 'datepicker',
                    plugin_config: {
                        format: 'dd/M/yyyy',
                        autoclose: true
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_DATEOFBIRTH',
                    label: 'Date of Birth',
                    type: 'date',
                    validation: {
                        format: 'DD/MMM/YYYY'
                    },
                    plugin: 'datepicker',
                    plugin_config: {
                        format: '\'dd/M/yyyy\'',
                        autoclose: true
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_DPD',
                    label: 'Days Past Due',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_TRN_SSN',
                    label: 'TRN',
                    type: 'string',
                    input: 'text',
                    validation: {
                        format: /^\d{9}?$/,
                        messages: {
                            format: 'A TRN Contains 9 Digits'
                        }
                    },
                    operators: ['equal', 'not_equal', 'contains', 'not_contains'],
                }, {
                    id: 'CI_TOTALEXPOSURE',
                    label: 'Total Exposure',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'CI_BROKENPROMISE',
                    label: 'Broken Promise',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'PROMISEAMOUNT',
                    label: 'Promise to Pay',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'CI_PRINCIPALBALANCEOUTSTANDING',
                    label: 'Principal Balance Outstanding',
                    type: 'double',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'UPPER(ACCOUNTTYPE)',
                    label: 'Product Type',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'CARD',
                        'LOAN'
                    ],
                    operators: ['equal', 'not_equal']
                }, {
                    id: 'UPPER(CI_NATUREOFADVANCE)',
                    label: 'Nature of Advance',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'SECURED',
                        'UNSECURED'
                    ],
                    operators: ['contains', 'not_contains', 'in']
                }, {
                    id: 'sol_id',
                    label: 'SOL ID',
                    type: 'string',
                    input: 'text',
                    validation: {
                        format: /^\d{3}?$/,
                        messages: {
                            format: 'Only 3 Digits are allowed.'
                        }
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'UPPER(ACCSTATUS)',
                    label: 'Account Status',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'D015',
                        'D030',
                        'D060',
                        'D090',
                        'WOFF',
                        'BLBD',

                    ],
                    operators: ['equal', 'not_equal', 'in']
                },
            ],
            default_group_flags: {
                no_add_rule: true
            }
        });

        $('#btn-reset').on('click', function () {
            $('#builder-basic').queryBuilder('reset');
        });



        $('#btn-get').on('click', function () {
            var result = $('#builder-basic').queryBuilder('getRules');

            if (!$.isEmptyObject(result)) {
                console.log(JSON.stringify(result, null, 2));
            }
        });
        $("#get-save").on('click', function () {
            if ($('#builder-basic').queryBuilder('validate') == false) {
                return;
            } else {
                $("#dialog-confirm").dialog('open');
            }

        })
    </script>

</body>

</html>