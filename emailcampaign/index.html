<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css">

    <link rel="stylesheet" href="https://rawgit.com/htkcodes/repo2/master/emailcampaign/query-builder.default.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/2.27.5/css/uikit.css">
    <link rel="stylesheet" href="main.css">
</head>

<body>
    <div id="dialog-confirm">
        <p>Once saved you cannot stop the process or start over. Are you sure?</p>
    </div>

    <div class="form-body">

        <div class="logo">
            <a href="#">
                <div class="inner"><img src="https://i.imgur.com/VIDLtws.png" alt="NCB Logo" class="logo-size"></div>
            </a>
        </div>
        <div class="uk-grid uk-height-1-1">
            <div class="uk-width-3-10 uk-text-center uk-vertical-align background uk-height-1-1">
                <div class="side-img uk-vertical-align-middle">
                    <img src="email.png" alt="Email Campaign icon">
                    <h1 class="white-text">Email Campaign</h1>
                </div>
            </div>
            <div class="uk-width-7-10 c_form">
                <h2 class="accent-text m-t-20">Email Campaign</h2>
                <p class="accent-text lato">Define the email campaign criteria below</p>
                <div class="seperator"></div>

                <div>
                  
                        <div class="uk-width-6-10 uk-form-stacked uk-container-center">
                                <div class="uk-form-row">
                                        <label for="" class="uk-form-label text-color">Criteria Name</label>
                                        <div class="uk-form-icon uk-width-7-10">
                                        <i class="uk-icon-info"></i>
                                        <input type="text" name="" id="criteria_name" class="uk-width-3-5 uk-form-large">
                                        </div>
                                        <p class="uk-form-help-block"></p>
                                    </div>

                                    <div class="uk-form-row">
                                           
                         
                                <div id="builder-basic" class="query-builder uk-width-5-5">

                                    </div>
                        
                                </div>
                                <div class="btn-group m-t-5">
                                    <button class="uk-button btn-radius reset uk-button-danger" data-target="basic" id="btn-reset">Reset</button>
                                    <button class="uk-button uk-button-success btn-radius parse-json" data-target="basic" id="get-save">Save</button>
                                </div>
                        </div>
                    
                </div>
            </div>
        </div>

    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.3/jquery.js"></script>
    <script src="jquery-loader.js"></script>
    <script>
        $(".openload").on('click', function () {
            $.loader.open({
                title: 'Loading'
            });
        })
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://rawgit.com/mistic100/jQuery.extendext/master/jQuery.extendext.min.js"></script>
    <script src="query-builder.standalone.js"></script>
    <script>
        $('#criteria_name').focus();

          $('#criteria_name').focusout(function () {
             if (!$('#criteria_name').val()) {
                 $('.uk-form-help-block').html('Please enter a criteria name')
                 $('#criteria_name').focus();
               $('#get-save').attr('disabled', true);
                $(this).addClass('uk-form-danger')
             }
         }) 
        $('#criteria_name').on('keyup', function () {
            $(this).removeClass('uk-form-danger');
            $('.uk-form-help-block').html('')
            $('#get-save').removeAttr('disabled');
        })



        $("#dialog-confirm").dialog({
            autoOpen: false,
            resizable: false,
            title: 'Are you sure?',
            height: "auto",
            width: 400,
            modal: true,
            buttons: {
                "Yes": function () {
                    $(this).dialog('close');
                    var sql_raw = $('#builder-basic').queryBuilder('getSQL', false, true);
                    console.log(sql_raw);
                    var newSql = sql_raw.sql.replace(/%/g, '#');
                    console.log(newSql)
                },
                Cancel: function () {
                    $(this).dialog("close");
                }
            }
        });
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.7.1/js/bootstrap-datepicker.min.js"></script>

    <script>
      
        $('#builder-basic').queryBuilder({
            plugins: ['bt-tooltip-errors'],

            filters: [{
                    id: 'ACCOUNT_NUMBER',
                    label: 'Account Number',
                    type: 'integer',
                    input: 'number',
                    validation: {
                        messages: {
                            format: 'Please ensure the input value is a number'
                        }
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ],
                },
                {
                    id: 'CI_ARREARS',
                    label: 'Arrears(Loans)',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_MINIMUMAMTDUE',
                    label: 'Mininum Payment(Cards)',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_CURRENTBAL',
                    label: 'Current Balance',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'UPPER(ci_occupation)',
                    label: 'Occupation',
                    type: 'integer',
                    input: 'select',
                    values: {
                        'DOCTOR': 'DOCTOR',
                        'TEACHER': 'TEACHER',
                        'FIRE': 'FIRE',
                        'SOLDIER': 'SOLDIER',
                        'LAWYER': 'LAWYER',
                        'HOUSEKEEPER': 'HOUSEKEEPER',
                        'CHEF': 'CHEF',
                        'WAITRESS': 'WAITRESS',
                        'OTHERS': ''
                    },
                    operators: ['contains', 'not_contains']
                }, {
                    id: 'UPPER(CI_CURRENCY)',
                    label: 'Currency',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'GBP',
                        'USD',
                        'CAD',
                        'JMD'
                    ],
                    operators: ['equal', 'not_equal']
                }, {
                    id: 'CI_PAYMENTDUEDATE',
                    label: 'Payment Due Date',
                    type: 'date',
                    validation: {
                        format: 'DD/MMM/YYYY'
                    },
                    plugin: 'datepicker',
                    plugin_config: {
                        format: 'dd/M/yyyy',
                        autoclose: true
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_DATEOFBIRTH',
                    label: 'Date of Birth',
                    type: 'date',
                    validation: {
                        format: 'DD/MMM/YYYY'
                    },
                    plugin: 'datepicker',
                    plugin_config: {
                        format: '\'dd/M/yyyy\'',
                        autoclose: true
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_DPD',
                    label: 'Days Past Due',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                },
                {
                    id: 'CI_TRN_SSN',
                    label: 'TRN',
                    type: 'string',
                    input: 'text',
                    validation: {
                        format: /^\d{9}?$/,
                        messages: {
                            format: 'A TRN Contains 9 Digits'
                        }
                    },
                    operators: ['equal', 'not_equal', 'contains', 'not_contains'],
                }, {
                    id: 'CI_TOTALEXPOSURE',
                    label: 'Total Exposure',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'CI_BROKENPROMISE',
                    label: 'Broken Promise',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'PROMISEAMOUNT',
                    label: 'Promise to Pay',
                    type: 'integer',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'CI_PRINCIPALBALANCEOUTSTANDING',
                    label: 'Principal Balance Outstanding',
                    type: 'double',
                    input: 'number',
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'UPPER(ACCOUNTTYPE)',
                    label: 'Product Type',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'CARD',
                        'LOAN'
                    ],
                    operators: ['equal', 'not_equal']
                }, {
                    id: 'UPPER(CI_NATUREOFADVANCE)',
                    label: 'Nature of Advance',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'SECURED',
                        'UNSECURED'
                    ],
                    operators: ['contains', 'not_contains', 'in']
                }, {
                    id: 'sol_id',
                    label: 'SOL ID',
                    type: 'string',
                    input: 'text',
                    validation: {
                        format: /^\d{3}?$/,
                        messages: {
                            format: 'Only 3 Digits are allowed.'
                        }
                    },
                    operators: ['equal', 'not_equal', 'greater', 'greater_or_equal', 'between',
                        'not_between', 'less', 'less_or_equal'
                    ]
                }, {
                    id: 'UPPER(ACCSTATUS)',
                    label: 'Account Status',
                    type: 'integer',
                    input: 'select',
                    values: [
                        'D015',
                        'D030',
                        'D060',
                        'D090',
                        'WOFF',
                        'BLBD',

                    ],
                    operators: ['equal', 'not_equal', 'in']
                },
            ],

        });

        $('#btn-reset').on('click', function () {
            $('#builder-basic').queryBuilder('reset');
        });

        var errorArray = [];
        $('#builder-basic').on('validationError.queryBuilder.filter', function (e, node, error, value) {

            console.log(e)

            console.log(node)
            /*    if(errorArray.indexOf(error.error[0]))
               {
                   errorArray.push(error.error[0])
               }  

               console.log(errorArray) */
        });



        $('#btn-get').on('click', function () {
            var result = $('#builder-basic').queryBuilder('getRules');

            if (!$.isEmptyObject(result)) {
                console.log(JSON.stringify(result, null, 2));
            }
        });
        $("#get-save").on('click', function () {
            if ($('#builder-basic').queryBuilder('validate') == false) {
                return;
            } else {
                $("#dialog-confirm").dialog('open');
            }

        })


    </script>

</body>

</html>